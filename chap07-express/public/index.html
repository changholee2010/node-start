<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <h3>express.static</h3>
    <form
      name="actionFrm"
      action="upload"
      method="post"
      enctype="multipart/form-data"
    >
      아이디: <input type="text" name="user_id" /><br />
      비밀번호: <input type="text" name="user_pw" /><br />
      이름: <input type="text" name="user_nm" /><br />
      이미지: <input type="file" name="user_img" /><br />
      <input type="submit" value="업로드" />
    </form>

    <script>
      // fetch 함수를 활용해서 file 전송.
      document
        .querySelector('form[name="actionFrm"]') //
        .addEventListener("submit", (e) => {
          e.preventDefault();

          const user_id = document.querySelector('input[name="user_id"]').value;
          const user_pw = document.querySelector('input[name="user_pw"]').value;
          const user_nm = document.querySelector('input[name="user_nm"]').value;
          const user_img = document.querySelector('input[name="user_img"]')
            .files[0];

          if (!user_id || !user_pw || !user_nm) {
            alert("필수 항목 입력!");
            return;
          }

          // multipart 요청처리.
          const formData = new FormData();
          formData.append("user_id", user_id); // formData의 user_id 속성과 값 추가.
          formData.append("user_pw", user_pw);
          formData.append("user_nm", user_nm);
          formData.append("user_img", user_img);

          // formData => user_name: '홍길동', user_age: 22, user_img: File()

          // fetch함수.
          fetch("create", {
            method: "post",
            body: formData,
          }) //
            .then((resp) => resp.json())
            .then((data) => {
              if (data.retCode == "OK") {
                // 가입성공하면 member.html 이동.
                location.href = "member.html";
              } else {
                // 실패하면 경고창 출력.
                alert(data.retMsg);
              }
            })
            .catch((err) => console.error(err));
        });
    </script>
  </body>
</html>
